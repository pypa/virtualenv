Abstract out caching in discovery - by :user:`esafak`.
