Replace ``ty: ignore`` comments with proper type narrowing using assertions and explicit None checks - by
:user:`rahuldevikar`.
